# IFAWL终焉结状态转移模式举例

## 约定

`self.state[AlStateIndex.BUILDING]`保存一个逐渐增长，瞬间归零的变量

`self.state[AlStateIndex.WORKING]`保存一个瞬间增长，逐渐归零的变量

`self.state[AlStateIndex.LOGGING]`保存一个任意灵活增减的变量

`self.state[AlStateIndex.COOLING]`保存一个瞬间减少，逐渐归零的负数变量


## 瞬发型终焉结

瞬发型终焉结在触发时，只检查战场当下状况，不检查state的任何值

    class Al3(Al_general):  # 风行者
    
        def react(self):
            if dice.probability(0.3 * enemy.shelter):
                self.ship.attack(1, DamageType.ORDINARY_ATTACK)
                self.report("命中")
            else:
                self.report("未命中")
    
        def suggest(self) -> str | None:
            prob = enemy.shelter * 30
            if prob != 0:
                return f"[e]发射巡飞弹|命中率{prob}%"
            else:
                return "[无命中率]不建议发射巡飞弹"

## 建筑-工作型终焉结

建筑-工作型终焉结在建造中使`BUILDING`增加，直到一个特定上限。

到达上限后，立刻使`WORKING`增加

同时`BUILDING`归零

`WORKING`随后随操作归零

    class Al4(Al_general):  # 咆哮
    
        def react(self):
            if self.state[AlStateIndex.WORKING] > 0:
                return
            if self.state[AlStateIndex.BUILDING] == 0:
                self.state[AlStateIndex.BUILDING] = 2
                self.report("准备好")
    
        def operate_in_afternoon(self):
            if self.state[AlStateIndex.BUILDING] == 2:
                self.state[AlStateIndex.BUILDING] = 0
                self.state[AlStateIndex.WORKING] = 2
    
            if self.state[AlStateIndex.WORKING] > 0:
                self.state[AlStateIndex.WORKING] -= 1
                if dice.probability(0.7):
                    self.ship.attack(1, "missile_launch")
                    self.report("命中")
                else:
                    self.report("未命中")
                    self.ship.load(1)
                    self.report("回流")
    
        def suggest(self) -> str | None:
            if self.state[AlStateIndex.BUILDING] == 0:
                return "[q]部署发射台"
            elif self.state[AlStateIndex.BUILDING] == 1:
                return "[q]挂载铜芯导弹 2/2"
            elif self.state[AlStateIndex.WORKING] > 0:
                return "[自动攻击中]回流系统正在生效"
            else:
                return None

## 建筑型终焉结

建筑型终焉结在建造中使`BUILDING`增加，直到一个特定上限。
到达上限后，`BUILDING`随一步操作归零

不改变`WORKING`的值

    class Al5(Al_general):  # 水银
    
        def react(self):
            if self.state[AlStateIndex.BUILDING] == 0:
                self.state[AlStateIndex.BUILDING] += 1
                self.report("收到")
            elif self.state[AlStateIndex.BUILDING] == 1:
                self.state[AlStateIndex.BUILDING] += 1
                self.report("准备好")
            else:
                self.state[AlStateIndex.BUILDING] = 0
                if random.randint(0, 9) > -1:
                    self.ship.attack(2, DamageType.MISSILE_LAUNCH)
                    self.report("命中")
                else:
                    self.report("未命中")
    
        def add_num(self, num) -> int:
            if self.state[AlStateIndex.BUILDING] == 2 and dice.probability(0.5):
                self.report("协助上弹")
                return num + 1
            else:
                return num
    
        def suggest(self):
            return \
                ["[q]建立汞弹推进器 1/2",
                 "[q]加注液态汞 2/2",
                 "[q]发射汞弹|[0/space]上弹效率加成中"][self.state[AlStateIndex.BUILDING]]

## 工作型终焉结
工作型终焉结在建造中使`WORKING`一步增加至上限。
到达上限后，`WORKING`随多步操作逐渐归零

不改变`BUILDING`的值

    class Al11(Al_general):  # 柒
    
        def react(self):
            if self.state[AlStateIndex.WORKING] == 0:
                self.state[AlStateIndex.WORKING] += 2
                self.ship.heal(1)
                self.report("收到")
                self.report("归来")
            elif self.state[AlStateIndex.WORKING] == 2:
                self.state[AlStateIndex.WORKING] -= 1
                self.ship.attack(1, DamageType.ORDINARY_ATTACK)
                self.ship.heal(1)
                self.report("为了身后的苍生")
    
        def reduce_enemy_heal(self, hp):
            if self.state[AlStateIndex.WORKING] == 0:
                return hp
            self.state[AlStateIndex.WORKING] -= 1
            self.ship.heal(1)
            self.report("汲取成功")
            hp -= 1
            return hp
    
        def suggest(self):
            return ["[w]建立汲能器", "[剩余一次]敌方护盾锁定中", "[就绪]敌方护盾锁定中|[w]主动汲取敌方护盾"][self.state[AlStateIndex.WORKING]]

## 记录型终焉结
记录型终焉结将维护`LOGGING`，使之灵活增减，不改变其它值

    class Al14(Al_general):  # 信风
    
        def react(self):
            if self.ship.shelter > 0:
                self.report("强化成功")
                self.state[AlStateIndex.LOGGING] += 3
                self.ship.shelter -= 1
            else:
                self.ship.heal(1)
                self.report("护盾不足")
            if dice.probability(0.2) and self.ship.shelter > 0:
                self.react()
    
        def reduce_enemy_attack(self, atk):
            minor = min(self.state[AlStateIndex.LOGGING], atk)
            if minor == self.state[AlStateIndex.LOGGING]:
                self.report("信风清空")
            self.state[AlStateIndex.LOGGING] -= minor
            atk -= minor
            return atk
    
        def get_equivalent_shelter(self):
            return self.state[AlStateIndex.LOGGING]
    
        def print_self(self):
            print(self.skin_list[self.state[AlStateIndex.LOGGING] % 3], end="")
            print("\n//\\\\//" * (self.state[AlStateIndex.LOGGING] // 3))
    
        def generate_line_list(self):
            print_list = []
            print_list.append(self.skin_list[self.state[AlStateIndex.LOGGING] % 3])
            print_list += ["//\\\\//"] * (self.state[AlStateIndex.LOGGING] // 3)
            return print_list
    
        def suggest(self):
    
            if self.ship.shelter == 0:
                return "[护盾不足]不能使用信风|[2]回充护盾"
            else:
                return "[w]强化护盾"

## 冷却型终焉结
冷却型终焉结在发动后使`COOLING`变为一个负数，并随任务执行时间逐渐归零

    class Al20(Al_general):  # 长安
        def react(self):
            if self.state[AlStateIndex.COOLING] == 0:
                dice.probability_current += 0.6
                self.state[AlStateIndex.COOLING] = -5
                self.report("扫描")
            else:
                self.report("冷却中")
    
        def operate_in_morning(self):
            if self.state[AlStateIndex.COOLING] < 0:
                self.state[AlStateIndex.COOLING] += 1
    
        def suggest(self):
            if self.state[AlStateIndex.COOLING] == 0:
                return f"[e]压制敌方行动|次日仍为我方航行日的概率：{dice.probability_current:.1f}"
            else:
                return f"[冷却中]剩余{-self.state[AlStateIndex.COOLING]}天|次日仍为我方航行日的概率：{dice.probability_current:.1f}"
